//TD3 HLIN511

//Q10
SELECT NUM_AB, NOM, (TARIF * (REDUC/100))
FROM ABONNE
WHERE REDUC IS NOT NULL
AND (TARIF * (REDUC/100)) < 20;

//Q11
SELECT TITRE, COUNT(NUMERO) AS NBEX
FROM LIVRE, EXEMPLAIRE
WHERE LIVRE.ISBN = EXEMPLAIRE.ISBN
AND CATEGORIE = 'ROMAN'
GROUP BY TITRE;

//Q12
SELECT TITRE, COUNT(NUMERO) AS NBEX
FROM LIVRE, EXEMPLAIRE
WHERE LIVRE.ISBN = EXEMPLAIRE.ISBN
AND CODE_PRET = 'EXCLU'
GROUP BY TITRE;
HAVING COUNT(NUMERO) > 2;

//Q13
SELECT NOM, PRENOM, COUNT(NUM_EX) AS NBEMPRUNTS
FROM ABONNE, EMPRUNT
WHERE ABONNE.NUM_AB = EMPRUNT.NUM_AB
GROUP BY NOM, PRENOM
HAVING COUNT(NUM_EX) = (SELECT MAX(NBEMPRUNTS) 
FROM (SELECT NOM, PRENOM, COUNT(NUM_EX) AS NBEMPRUNTS
FROM ABONNE, EMPRUNT
WHERE ABONNE.NUM_AB = EMPRUNT.NUM_AB
GROUP BY NOM, PRENOM));

//Q14
SELECT EXEMPLAIRE.ISBN, TITRE
FROM EMPRUNT, EXEMPLAIRE, LIVRE
WHERE EMPRUNT.NUM_EX = EXEMPLAIRE.NUMERO
AND EXEMPLAIRE.ISBN = LIVRE.ISBN
GROUP BY EXEMPLAIRE.ISBN, TITRE
HAVING COUNT(NUM_EX) >= (SELECT COUNT(*)
FROM EMPRUNT, EXEMPLAIRE, LIVRE
WHERE EMPRUNT.NUM_EX = EXEMPLAIRE.NUMERO
AND EXEMPLAIRE.ISBN = LIVRE.ISBN
AND TITRE = 'LE MUR');

//Q15
SELECT NUMERO
FROM EXEMPLAIRE
WHERE NUMERO NOT EXISTS
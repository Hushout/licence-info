#include <stdio.h>
#include <stdlib.h>
#include "compression.h"

int main(int argc, char** argv){

  if(argc < 2 || argc > 3) {
    printf("Syntaxe : %s fichier | %s fichier dest\n", argv[0], argv[0]);
    return 1;
  }
  
  int tailleTN = 0;
  Noeud* TN = fileToTN(argv[1], &tailleTN);
    
  printf("Nombre de car de %s : %d\n", argv[1], nbCar(argv[1]));
  printf("Nombre de car diff de %s : %d\n", argv[1], nbCarDiff(argv[1]));

  printf("\n");
  triCroisTN(TN, tailleTN);
  afficheTN(TN, tailleTN);
  printf("\n");
  ArbreBin A = creerArbreHuf(TN, tailleTN);
  afficheA(A);
  printf("\n");
  if(argc == 2){
    char* nomDest = NULL;
    nomDest = concat(argv[1], ".huf");
    enregistrerTN(TN, tailleTN, nbCar(argv[1]), nomDest);
    compress(A, argv[1], nomDest);
  }
  else{
    enregistrerTN(TN, tailleTN, nbCar(argv[1]), argv[2]);
    compress(A, argv[1], argv[2]);
  }
  parcourPrefixeCode(A);
  return 0;
}

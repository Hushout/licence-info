#include "fonction-utile.h"

//////////////////// AFFICHAGE ///////////////////////
//////////////////////////////////////////////////////


void espace(int nbEspace){
  for(int i = 0 ; i < nbEspace ; i++){
    printf(" ");
  }
}

void afficheChar(char c){
  if(c == 0){
    printf("\\0");
  }
  else if(c == '\n'){
    printf("\\n");
  }
  else if(c == '\t'){
    printf("\\t");
  }
  else if(c == ' '){
    printf("' '");
  }
  else{
    printf("%c", c);
  }
}


///////////////// FONCTION SIMPLES ///////////////////
//////////////////////////////////////////////////////


int estPair(int n){ return n % 2 == 0; }

int max(int a, int b){ return a >= b ? a : b;}

int puiss(int a, int b){
  int res = 1;
  for(int i = 0 ; i < b ; i++){
    res = res*a;
  }
  return res;
}

int estPuiss(int n, int a){
  float res = n;
  while(res > a){
    res/=a;
  }
  return n == 1 ? 1 : res == a;
}

int sommeTab(int* T, int taille){
  int res = 0;
  for(int i = 0 ; i < taille ; i++){
    res += T[i];
  }
  return res;
}


///////////////// FONCTION STRING ////////////////////
//////////////////////////////////////////////////////


char* itoa(unsigned int n){
  unsigned int k = n;
  int taille = 0;
  while(k != 0){
    k = k/10;   
    taille++;
  }
  char* T = malloc(sizeof(char)*taille);
  for(int i = 0 ; i < taille ; i++){
    T[i] = 0;
  }
  sprintf(T, "%d", n);
  return T;
}

char* initT(char* T, int taille){
  for(int i = 0 ; i < taille ; i++){
    T[i] = 0;
  }
  return T;
}

char* debutT(char* T, int nouvTaille){
  if(T == NULL){
    printf("ERREUR : Dans debutT parametre NULL\n");
    return NULL;
  }
  else{
    char* newT = malloc(sizeof(char)*nouvTaille+1);
    for(int i = 0 ; i < nouvTaille ; i++){
      newT[i] = T[i];
    }
    newT[nouvTaille] = '\0';
    return newT;
  }
}

char* finT(char* T, unsigned int posCoupe){
  if(T == NULL){
    printf("ERREUR : Dans finT parametre NULL\n");
    return NULL;
  }
  else{
    if(strlen(T) < posCoupe){
      printf("ERREURR : Dans finT overflow\n");
      return NULL;
    }
    else{
      return T+posCoupe;
    }
  }
}

char* concat(char* T1, char* T2){
  if(T1 == NULL || T2 == NULL){
    printf("ERREURR : Dans concat parametre NULL\n");
    return NULL;
  }
  else{
    int taille = strlen(T1) + strlen(T2);
    char* T = malloc(sizeof(char)*taille+1);
    for(int i = 0 ; i < taille ; i++){
      T[i] = 0;
    }
    strcat(T, T1);
    strcat(T, T2);
    return T;
  }
}

int estDansT(char* T, char c, int taille){
  int i = 0;
  while(T[i] != c && i < taille){
    i++;
  }
  return taille == 0 ? 0 : i != taille;
}


///////////////// FONCTION FICHIER ///////////////////
//////////////////////////////////////////////////////


int nbCar(char* fichier){ 
  FILE* fic = fopen(fichier,"r");
  int nb = 0;
  
  if(fic == NULL){
    printf("ERREUR : Dans nbCar, ouverture fichier impossible\n");
    return -1; //impossible ouvrir fichier
  }
  
  while(fgetc(fic) != EOF){
    nb++;
  }
  fclose(fic);
  
  return nb;
}

int nbCarDiff(char* fichier){
  FILE* fic = fopen(fichier,"r");
  int nb = 0;
  
  if(fic == NULL){
    printf("ERREUR : Dans nbCarDiff, ouverture fichier impossible\n");
    return -1; //impossible ouvrir fichier
  }

  char carCourant = fgetc(fic);
  char T[256] = {0};
  
  while(carCourant != EOF){
    if(!estDansT(T, carCourant, 256) && nb < 256){
      T[nb] = carCourant;
      nb++;
    }
    carCourant = fgetc(fic);
  }
  fclose(fic);

  return nb;
}

float probCar(char* fichier, char c){
  FILE* fic = fopen(fichier,"r");
  int nbTot = nbCar(fichier);
  int nb = 0;
      
  if(fic == NULL){
    printf("ERREUR : Dans probCar, ouverture fichier impossible\n");
    return -1; //impossible ouvrir fichier
  }
  
  char carCourant = fgetc(fic);
  
  while(carCourant != EOF){
    if(carCourant == c){
      nb++;
    }
    carCourant = fgetc(fic);
  }
  fclose(fic);
  
  return nbTot == 0 ? 0 : nb/((float) nbTot);
}

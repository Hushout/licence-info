#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>

int calculProba(char* chemin, float *proba){
  int fic = open(chemin, O_RDONLY);
  
  if(fic < 0){
    return 1; //impossible ouvrir fichier
  }
  
  int compte[256] = {0};
  int taille = 0;
  int c = 0;
  
  while(0 < read(fic, &c, 1)){
    compte[c]++;
    taille++;
  }
  
  close(fic);
  
  if(taille == 0){
    return 2; //fichier vide
  }

  for(int i = 0 ; i < 256 ; i++){
    proba[i] = compte[i]/(float)taille; //evite la division int
  }
  
  return 0; //OK
}

int main(int argc, char* argv[]){

  
  if(argc != 2) {
    printf("Syntaxe : proba fichier\n");
    return 1;
  }

  float proba[256];

  if(!calculProba(argv[1], proba)){
    for(int i = 0 ; i < 256 ; i++){
      if(proba[i] != 0){
	printf("car : %c de code : %x de proba : %f\n", i, i, proba[i]);
      }
    }
    return 0; //OK
  }

  return 2; //calcul impossible
}
